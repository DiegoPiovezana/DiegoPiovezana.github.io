<html>

<head>

  <meta charset="utf-8">
  <title>TOMB OF THE MASK - Winter</title>
  <meta name="description" content="Um jogo inspirado no jogo Tomb of the Mask">

  <script src="https://aframe.io/releases/0.6.0/aframe.min.js"></script>

  <!-- Ambiente -->
  <script src="https://unpkg.com/aframe-environment-component/dist/aframe-environment-component.min.js"></script>

  <script src="//cdn.rawgit.com/donmccurdy/aframe-extras/v3.2.0/dist/aframe-extras.min.js"></script>

  <script src="//cdn.rawgit.com/donmccurdy/aframe-physics-system/v1.2.0/dist/aframe-physics-system.min.js"></script>


  <!-- <script
    src="https://rawgit.com/ngokevin/aframe-look-at-component/master/dist/aframe-look-at-component.min.js"></script>
   -->
  <script src="https://unpkg.com/aframe-maze-component@0.1.20/dist/aframe-maze-component.min.js"></script>

  <script src="https://unpkg.com/aframe-physics-extras@0.1.2/dist/aframe-physics-extras.min.js"></script>

</head>

<!-- Ícone na guia do navegador -->
<link rel="shortcut icon" href="icons/16x16.png">

<body>

  <!-- 
      CENÁRIOS:

      default
      forest
      arches
      volcano ##### Fogo
      egypt
      tron
      goaland
      starry
      osiris
      contact 
      checkerboard
      poison
      japan
      yavapai
      goldmine
      dream
      threetowers #### Gelo
     -->

  <script>

    var pontuacao; /* Valor do score */
    var score; /* Elemento Score */
    var scoreCamera; /* Mostrador na câmera */
    var tempo;
    var dentro; /* Dentro ou fora do labirinto */
    var posicaoJogador;
    var fim; /* Fim do jogo = tempo esgotado */
    var derrota;

    var perdeu;

    var valorPontos;
    var jogador;
    var tempoInicio;
    var tempoAtual;

  </script>




  <a-scene environment="preset: threetowers" physics="debug: false">

    <!-- SOM -->
    <!-- <a-sound src="intro.mp3" autoplay="true" position="0 0 0"></a-sound> -->

    <!-- Som nas saídas do labirinto -->
    <!-- <a-sound src="intro.mp3" autoplay="true" position="30 0 0"></a-sound> -->
    <!-- Leste -->
    <!-- <a-sound src="intro.mp3" autoplay="true" position="-14 0 0"></a-sound> -->
    <!-- Norte -->

    <a-sound src="congelar.mp3" autoplay="true" position="0 0 0"></a-sound>
    <a-sound id=musica src="intro.mp3" autoplay="true" position="-30 0 30" loop="true" on=true></a-sound>
    <!-- Som na única saída Sul -->

    <!-- Música Vitória -->
    <a-sound src="congelar.mp3" autoplay="false" position="0 0 0" on=false></a-sound>

    <!-- TIMER - Não funciona-->
    <!-- <div class="circle-timer"></div> -->


    <a-text value="Score: 0" width="100" id="score" rotation="0 0 0" color="white" position="-5 40 0" rotation="0 0 0"
      visible="true"></a-text>

    <a-text value="VITORIA!" width="500" id="vitoria" rotation="0 0 0" color="blue" position="-15 25 0"
      rotation="-10 45 -20" visible="false"></a-text>

    <a-text value="Você Perdeu!" width="1.3" id="perdeu" rotation="0 -90 0" color="black" position="-13.9 5 -6.17"
      rotation="0 0 0" visible="false"></a-text>

    <!-- <a-text value="Teste 1" geometry="primitive:plane"></a-text> -->


    <a-assets>

      <!-- Texturas labirinto -->
      <img id="texture-wall" src="img/Wall-maze.png">
      <img id="texture-floor" src="img/gelo.png">

      <img id="texture-fluido" src="img/agua.png">

      <!-- Muros -->
      <a-box id="wall-one" static-body material="src: #texture-wall" depth="1" width="4" height="5">
      </a-box>

      <!-- Colunas -->
      <a-cylinder id="end-cap" static-body color="#444444" depth="1.1" width="1.1" height="6" radius="0.4">
      </a-cylinder>

    </a-assets>

    <!-- Céu -->
    <!-- <a-sky id="sky" color="#0000ff"></a-sky> -->

    <!-- Caixa vermelha no centro - ignora colisão (teste) -->
    <!--   <a-box id="center" 
          position="0 0 0"
          color="red" 
          depth="0.5" width="0.5" height="10">
      </a-box> -->


    <!-- ########################### CÂMERAS TESTADAS ######################################## -->

    <!-- Câmera (com apenas muro concreto)-->
    <a-entity id="jogador" camera="userHeight: 1.8" universal-controls kinematic-body position="24 0 0">
      <a-text id=scoreCamera value="Teste Camera" width="1" geometry="primitive:plane; height: 0.1; width:0.1 "
        position="-0.7 0.35 -0.5" visible="false"></a-text>
    </a-entity>

    <!-- Posição longe da saída: 24 0 0  -->
    <!-- Saída: -30 0 20-->



    <!-- Câmera (Objetos ficam abstratos = jogador cai) -->
    <!-- <a-entity id="jogador"
          camera="userHeight: 1.8"
          universal-controls
          kinematic-body
          position="-20 10.8 20"
          physics-collider="ignoreSleep: true">
      </a-entity> -->

    <!-- Câmera (câmera flutua)-->
    <!-- <a-box src="https://images-na.ssl-images-amazon.com/images/I/21ZzpgClpiL.png" 
      height="0.6" width="0.6" depth="0.1" 
      bird id="bird" position="-20 10.8 20" rotation="-1 0 0" 
      static-body physics-collider="ignoreSleep: true">
        <a-camera 
        id="camera"
        
        look-controls-enabled="false">
        
        </a-camera>
      </a-box> -->


    <!-- Câmera MP -->
    <!-- <a-entity 
      camera look-controls wasd-controls 
      acceleration="500" 
      position="0 2 1" static-body
      physics-collider="ignoreSleep: true" 
      geometry="primitive: box; width: 1.1; height: 2.5; depth: 1.1"
      avatar>
      </a-entity> -->

    <!-- ############################################################################## -->


    <!-- Caixa de vista panorâmica para se apoiar / Caixa "trampolim" -->
    <!-- <a-box static-body physics-collider="ignoreSleep: true" id= "trampolim"
          static-body 
          depth="0.25" height="0.5" width="0.5" 
          position="0 10 0"
          color="red">          
      </a-box> -->

    <!-- Labirinto  -->
    <a-entity id="maze" maze='size: 15 15; wall: #wall-one; cap: #end-cap; open: S 0; opacity: 0.2; transparent: true"'
      position='0 0.1 0' rotation='0 0 0'>
    </a-entity>


    <!-- Chão -->
    <a-box id="solo" position='0 0 0' static-body physics-collider="ignoreSleep: true" width="400" height="1"
      depth="400" static-body material="src: #texture-floor; opacity: 0.8; transparent: true" visible=true>
      <a-animation attribute="scale" dur="999999" from="1 0.5 1" to="0 0 0" direction="alternate-reverse"
        easing="ease-out-circ"></a-animation>
    </a-box>

    <!-- Sub-solo -->
    <!-- <a-box id="sub-solo" 
      position='0 -10 0' 
      width="200" height="5" depth="200" 
      static-body material="src: #texture-subsolo; opacity: 1.0; transparent: true">      
    </a-box>  -->


    <!-- Água/Lava -->
    <a-box id="fluido" width="300" height="2" depth="300" static-body
      material="src: #texture-fluido; opacity: 0.9; transparent: true" visible=true>
      <a-animation attribute="position" dur="999999" from="0 -1 0" d to="0 0.1 0">
    </a-box>


    <!-- Placa superior -->
    <!-- <a-box id="placa-superior" 
      width="60" height="1" depth="60"     
      color="black">
      <a-animation 
        attribute="position"
        dur="5000"
        from="0 70 0"
        to="0 1 0"
        repeat="indefinite">
    </a-animation>
    </a-box> -->


    <!-- ## ANIMAÇÕES ## -->

    <!--  <a-animation 
    attribute="rotation"
    dur="50000"
    to="0 360 0"
    repeat="indefinite"
    easing= "linear"> -->

    <!-- <a-animation 
    attribute="material.color"
    dur="50000"
    from="blue"
    to="red"
    repeat="indefinite"> -->

    <!-- <a-animation 
    attribute="scale"
    dur="50000"
    from="1 1 1"
    to="3 3 3"
    direction="alternate-reverse"
    easing="ease-in-out-circ"
    repeat="indefinite"> -->

    <!-- Fim dos tipos de animações -->

  </a-scene>


  <script>


    jogador = document.getElementById("jogador");
    score = document.getElementById("score");
    scoreCamera = document.getElementById("scoreCamera");
    perdeu = document.getElementById("perdeu");
    vitoria = document.getElementById("vitoria");
    gelo = document.getElementById("solo");
    agua = document.getElementById("fluido");
    musica = document.getElementById("musica");

    function iniciar() {

      console.log("JOGO INICIADO")

      tempoInicio = new Date();
      dentro = true;
      fim = false;
      derrota = false;

      console.log("ScoreCamera:" + pontuacao);

      valorPontos = 0;

      score.setAttribute("value", "Score: " + pontuacao);


    }
    window.onloadend = window.alert("Saia do labirinto antes que o gelo quebre e você morra congelado(a)!");

    function verificaJogador() {

      console.log("Tecla Pressionada!");

      if (fim == false) {

        tempo = comparaTempo();
        pontuacao = 1000 - tempo;

        console.log("Score: " + pontuacao);

        scoreCamera.setAttribute("visible", "true");

        /* Atualiza Score do final do labirinto */
        score.setAttribute("value", "Score: " + pontuacao);
        scoreCamera.setAttribute("value", "Score: " + pontuacao);

        jogador = document.getElementById("jogador");
        posicaoJogador = jogador.getAttribute("position");

        console.log("X = " + posicaoJogador.x);
        console.log("Y = " + posicaoJogador.y);
        console.log("Z = " + posicaoJogador.z);

        if (posicaoJogador.z > 35 && derrota == false) { /* Se jogador saiu para fora do labirinto na saída SUL */
          console.log("SAIU!"); /* Ganhou */

          vitoria.setAttribute("visible", "true");
          gelo.setAttribute("visible", "false");
          agua.setAttribute("visible", "false");

          dentro = false;
          fim = true;
        }

        if (tempo > 100 && dentro) { /* Se tempo esgotou */
          console.log("CONGELOU!");

          fim = true;
          perdeu.setAttribute("visible", "true");
          musica.setAttribute("on","false");

          derrota = true;

        }
      }
    }

    function comparaTempo() { /* Retorna os segundos passados */


      var horaInicio = tempoInicio.getHours();
      var minutoInicio = tempoInicio.getMinutes();
      var segundoInicio = tempoInicio.getSeconds();

      var segundosInicio = horaInicio * 3600 + minutoInicio * 60 + segundoInicio;

      /* console.log("Início: "+segundosInicio); */


      var tempoAgora = new Date();

      var horaAgora = tempoAgora.getHours();
      var minutoAgora = tempoAgora.getMinutes();
      var segundoAgora = tempoAgora.getSeconds();

      var segundosAgora = horaAgora * 3600 + minutoAgora * 60 + segundoAgora;

      /* console.log("Agora: "+segundosAgora); */

      tempo = segundosAgora - segundosInicio;

      return tempo;


    }

    iniciar();
    document.addEventListener('keydown', verificaJogador);


  </script>

</body>

</html>